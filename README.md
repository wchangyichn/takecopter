# takecopter

本地优先的故事创作工作台，聚焦「设定管理 + AI 辅助创作 + 结构化创作 + 项目迁移」。

## 项目介绍（PRD 摘要）
- 问题背景：传统线性时间线难以承载多线并行、交汇与回溯叙事，复杂故事在落地时容易被工具能力限制。
- 产品定位：融合 Git 分支模型、时间线切片和双向链接机制，服务小说、剧本、游戏剧情与 TRPG 战役等复杂叙事创作。
- 核心目标：支持多线并行演进、交汇段一致性编辑、可控共享修改作用域、设定与切片双向追溯，以及会话级/版本级可逆操作。
- 关键对象：故事线（主线/支线）、切片（最小叙事单元）、交汇段（多线共享结构段）、激活线（结构操作上下文）。

## 大纲页功能特性（MVP）
- 双视图工作模式：全知视角用于俯瞰分支拓扑，聚焦视角用于单线编辑与交汇段细化。
- 交汇段统一语义：多条线共享同一交汇段对象，段内修改保持参与线同步，避免局部语义漂移。
- 激活线与焦点分离：激活线提供事务上下文，当前焦点对象用于段内编辑与面板联动。
- 结构化可视交互：故事线、切片、交汇段提供一致选中反馈与信息面板联动，提升复杂叙事可控性。

## 功能总览
- 首页：创建故事、故事列表、导入导出、模型密钥设置（按模型保存 API Key）。
- 故事页-设定：卡片画布、关系连接、预览弹窗、多窗口管理、设定编辑页。
- 故事页-创作：结构树（EP > Scene > Shot > Take）与节点编辑持久化。
- 模版系统：卡片可保存为全局/故事模版，新建卡片可直接套用标签与属性。
- 数据迁移：项目导入/导出 JSON（带 `schemaVersion`），支持旧数据迁移。

## 关键交互
- 信息架构：`首页 -> 故事页（设定 / 创作）`。
- 设定卡片：拖拽定位持久化；点击打开高保真预览；可同时打开多个预览窗口。
- 设定编辑：固定属性（名称/摘要/分类/标签）+ 可拖拽排序属性。
- AI 工作台：引导、生成、审校、润色、外部辅助统一聚合；所有落卡修改均需确认。
- 就近润色：摘要与单条属性可在旁边直接触发润色。

## AI 辅助能力（设定编辑页）
- 分步设定引导：根据卡片分类/标签/已有属性动态生成问题并引导补全。
- 摘要生成属性：优先补全已有属性，缺失维度再新增。
- 审校并建议更新：读取摘要+属性输出 patch，支持按字段勾选应用。
- 属性生成摘要：仅基于属性重建摘要。
- 润色：支持整卡/摘要/单条属性，弹窗输入方案（多行），并可复用最近方案。
- 外部 AI 辅助：按模式生成提示词，支持 `summary` / `field` / `suggestions` / `patch` 导入。

## 工程架构
- 工程架构说明：`docs/ARCHITECTURE.md`
- 客户端主目录：`apps/desktop`
- 关键层次：
  - `src/views` 页面与交互编排
  - `src/hooks` 状态与用例
  - `src/data` 仓储抽象与存储适配
  - `src-tauri` 桌面原生能力与 SQLite

## 构建与验证
```bash
cd apps/desktop
npm install
npm run dev
npm run lint
npm run build
cargo check --manifest-path src-tauri/Cargo.toml
```

## 文档
- 架构文档：`docs/ARCHITECTURE.md`
- 变更记录：`CHANGELOG.md`
- 计划文档：`docs/plans/`
